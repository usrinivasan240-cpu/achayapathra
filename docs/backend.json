{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the Achayapathra application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "role": {
          "type": "string",
          "description": "User's role (e.g., donor, receiver, volunteer, admin)."
        },
        "verified": {
          "type": "boolean",
          "description": "Indicates whether the user's identity is verified."
        },
        "points": {
          "type": "number",
          "description": "User's reward points."
        },
        "location": {
          "type": "string",
          "description": "User's location (e.g., coordinates or address)."
        },
        "identityId": {
          "type": "string",
          "description": "Unique identifier for the user's verified identity."
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "verified",
        "points",
        "location",
        "identityId"
      ]
    },
    "Donation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Donation",
      "type": "object",
      "description": "Represents a food donation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Donation entity."
        },
        "donorId": {
          "type": "string",
          "description": "Reference to User (Donor). (Relationship: User 1:N Donation)"
        },
        "foodName": {
          "type": "string",
          "description": "Name of the food item."
        },
        "foodType": {
          "type": "string",
          "description": "Type of food (e.g., cooked, perishable)."
        },
        "cookedTime": {
          "type": "string",
          "description": "Time when the food was cooked.",
          "format": "date-time"
        },
        "expiryTime": {
          "type": "string",
          "description": "Expiration date and time of the food.",
          "format": "date-time"
        },
        "quantity": {
          "type": "string",
          "description": "Quantity of food available for donation."
        },
        "description": {
          "type": "string",
          "description": "Optional description of the food donation."
        },
        "location": {
          "type": "string",
          "description": "Location where the food can be picked up."
        },
        "imageURL": {
          "type": "string",
          "description": "URL of the food image.",
          "format": "uri"
        },
        "aiImageAnalysis": {
          "type": "string",
          "description": "Result of the AI image analysis for food safety."
        },
        "status": {
          "type": "string",
          "description": "Status of the donation (e.g., available, picked up, delivered)."
        }
      },
      "required": [
        "id",
        "donorId",
        "foodName",
        "foodType",
        "cookedTime",
        "expiryTime",
        "quantity",
        "location",
        "imageURL",
        "aiImageAnalysis",
        "status"
      ]
    },
    "VolunteerTask": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VolunteerTask",
      "type": "object",
      "description": "Represents a volunteer task for picking up or delivering donations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the VolunteerTask entity."
        },
        "volunteerId": {
          "type": "string",
          "description": "Reference to User (Volunteer). (Relationship: User 1:N VolunteerTask)"
        },
        "donationId": {
          "type": "string",
          "description": "Reference to Donation. (Relationship: Donation 1:N VolunteerTask)"
        },
        "type": {
          "type": "string",
          "description": "Type of volunteer task (e.g., pickup, delivery)."
        },
        "status": {
          "type": "string",
          "description": "Status of the volunteer task (e.g., pending, in progress, completed)."
        }
      },
      "required": [
        "id",
        "volunteerId",
        "donationId",
        "type",
        "status"
      ]
    },
    "Feedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feedback",
      "type": "object",
      "description": "Represents feedback given for a donation or volunteer task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Feedback entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Feedback)"
        },
        "donationId": {
          "type": "string",
          "description": "Reference to Donation. (Relationship: Donation 1:N Feedback)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given (e.g., 1 to 5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment associated with the feedback."
        }
      },
      "required": [
        "id",
        "userId",
        "donationId",
        "rating"
      ]
    },
    "Leaderboard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Leaderboard",
      "type": "object",
      "description": "Represents the leaderboard data for top donors and volunteers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Leaderboard entity."
        },
        "date": {
          "type": "string",
          "description": "Date for which the leaderboard is generated.",
          "format": "date-time"
        },
        "topDonors": {
          "type": "array",
          "description": "Array of user IDs of the top donors.",
          "items": {
            "type": "string"
          }
        },
        "topVolunteers": {
          "type": "array",
          "description": "Array of user IDs of the top volunteers.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "date",
        "topDonors",
        "topVolunteers"
      ]
    },
    "SiteStats": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SiteStats",
      "type": "object",
      "description": "Represents site statistics related to hunger data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SiteStats entity."
        },
        "date": {
          "type": "string",
          "description": "Date for which the statistics are recorded.",
          "format": "date-time"
        },
        "hungerData": {
          "type": "string",
          "description": "Data related to hunger statistics (e.g., number of people fed)."
        }
      },
      "required": [
        "id",
        "date",
        "hungerData"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Only the user and admins can read/write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/donations/{donationId}",
        "definition": {
          "entityName": "Donation",
          "schema": {
            "$ref": "#/backend/entities/Donation"
          },
          "description": "Stores donations made by a user. Includes denormalized 'donorId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "donationId",
              "description": "The unique ID of the donation."
            }
          ]
        }
      },
      {
        "path": "/volunteerTasks/{volunteerTaskId}",
        "definition": {
          "entityName": "VolunteerTask",
          "schema": {
            "$ref": "#/backend/entities/VolunteerTask"
          },
          "description": "Stores volunteer tasks. Includes references to 'volunteerId' and 'donationId'.",
          "params": [
            {
              "name": "volunteerTaskId",
              "description": "The unique ID of the volunteer task."
            }
          ]
        }
      },
      {
        "path": "/feedbacks/{feedbackId}",
        "definition": {
          "entityName": "Feedback",
          "schema": {
            "$ref": "#/backend/entities/Feedback"
          },
          "description": "Stores feedback for donations and volunteer tasks. Includes references to 'userId' and 'donationId'.",
          "params": [
            {
              "name": "feedbackId",
              "description": "The unique ID of the feedback."
            }
          ]
        }
      },
      {
        "path": "/leaderboard/{leaderboardId}",
        "definition": {
          "entityName": "Leaderboard",
          "schema": {
            "$ref": "#/backend/entities/Leaderboard"
          },
          "description": "Stores leaderboard data. Publicly readable.",
          "params": [
            {
              "name": "leaderboardId",
              "description": "The unique ID of the leaderboard entry."
            }
          ]
        }
      },
      {
        "path": "/siteStats/{siteStatsId}",
        "definition": {
          "entityName": "SiteStats",
          "schema": {
            "$ref": "#/backend/entities/SiteStats"
          },
          "description": "Stores site statistics. Admin-only access.",
          "params": [
            {
              "name": "siteStatsId",
              "description": "The unique ID of the site statistics entry."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store admin roles. Existence of a document grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user with admin privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Achayapathra (SharePlate) application, focusing on food donations and related activities. The design prioritizes security, scalability, and maintainability, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters).  \n\n**Authorization Independence:** This is achieved through denormalization. For example, access to donations requires knowing the donor. This information is duplicated in subcollections if access to them depends on the donation's attributes. Collaborative access uses membership maps.  This prevents `get()` calls in security rules.\n\n**Structural Segregation:** Data with different access requirements are stored in separate collections. User profiles are stored under `/users/{userId}`, ensuring only the user (and admins) can access them. Publicly accessible data, such as leaderboards, is stored in a dedicated collection (`/leaderboard`) with rules that allow read access.\n\n**Access Modeling:** Ownership is explicitly modeled using path-based ownership (`/users/{userId}/donations/{donationId}`). Collaborative access (e.g., admin roles) uses dedicated collections like `/roles_admin/{userId}`.\n\n**QAPs (Rules are not Filters):** The structure enables secure list operations.  For example, listing donations is allowed, but security rules ensure that only authorized users can access sensitive donation data.  Admin roles are checked against the `/roles_admin` collection. The separation of private and public data into different collections ensures that list operations do not expose sensitive data.\n\n**Invariants:** The structure supports the integrity of ownership and timestamps. For instance, the `donorId` field in the `donations` collection ensures that each donation is associated with a specific user. Timestamps (e.g., `cookedTime`, `expiryTime`) can be enforced through security rules to ensure data consistency.\n\n**Denormalization Strategy:** The `donations` documents include the `donorId` to link back to the user who created them, avoiding the need for `get()` calls to the `users` collection in security rules related to donations. This ensures authorization independence. The `volunteerTasks` document links both `volunteerId` and `donationId` to the corresponding collections.\n\n**Admin Roles:**  The `/roles_admin/{userId}` collection supports the admin role. The existence of a document in this collection grants admin privileges to the corresponding user.  The security rules check for the existence of this document to authorize admin-only operations.\n"
  }
}