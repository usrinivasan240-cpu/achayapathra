{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the Achayapathra application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "role": {
          "type": "string",
          "description": "User's role within the application (e.g., donor, receiver, volunteer, admin)."
        },
        "verified": {
          "type": "boolean",
          "description": "Indicates whether the user's identity has been verified."
        },
        "points": {
          "type": "number",
          "description": "User's accumulated reward points."
        },
        "location": {
          "type": "string",
          "description": "User's location (e.g., geographic coordinates)."
        }
      },
      "required": [
        "id",
        "email",
        "displayName",
        "role",
        "verified",
        "points"
      ]
    },
    "Donation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Donation",
      "type": "object",
      "description": "Represents a food donation within the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the donation entity."
        },
        "donorId": {
          "type": "string",
          "description": "Reference to the User who made the donation. (Relationship: User 1:N Donation)"
        },
        "foodName": {
          "type": "string",
          "description": "Name of the food being donated."
        },
        "foodType": {
          "type": "string",
          "description": "Type of food (e.g., cooked, uncooked)."
        },
        "cookedTime": {
          "type": "string",
          "description": "Time the food was cooked (if applicable).",
          "format": "date-time"
        },
        "expiryTime": {
          "type": "string",
          "description": "Expiration time of the food.",
          "format": "date-time"
        },
        "quantity": {
          "type": "string",
          "description": "Quantity of food being donated."
        },
        "description": {
          "type": "string",
          "description": "Optional description of the donation."
        },
        "location": {
          "type": "string",
          "description": "Location where the donation can be picked up."
        },
        "imageURL": {
          "type": "string",
          "description": "URL of the food image.",
          "format": "uri"
        },
        "aiImageAnalysis": {
          "type": "string",
          "description": "AI analysis of the image."
        },
        "status": {
          "type": "string",
          "description": "Status of the donation (e.g., available, picked up, delivered)."
        }
      },
      "required": [
        "id",
        "donorId",
        "foodName",
        "foodType",
        "expiryTime",
        "quantity",
        "location",
        "imageURL",
        "status"
      ]
    },
    "VolunteerTask": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VolunteerTask",
      "type": "object",
      "description": "Represents a volunteer task for picking up or delivering donations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the volunteer task entity."
        },
        "donationId": {
          "type": "string",
          "description": "Reference to the Donation associated with this task. (Relationship: Donation 1:N VolunteerTask)"
        },
        "volunteerId": {
          "type": "string",
          "description": "Reference to the User assigned to this task. (Relationship: User 1:N VolunteerTask)"
        },
        "taskType": {
          "type": "string",
          "description": "Type of task (e.g., pickup, delivery)."
        },
        "status": {
          "type": "string",
          "description": "Status of the task (e.g., pending, in progress, completed)."
        }
      },
      "required": [
        "id",
        "donationId",
        "volunteerId",
        "taskType",
        "status"
      ]
    },
    "Feedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feedback",
      "type": "object",
      "description": "Represents feedback given by users for donations or volunteer tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the feedback entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who gave the feedback. (Relationship: User 1:N Feedback)"
        },
        "donationId": {
          "type": "string",
          "description": "Reference to the Donation the feedback is about. (Relationship: Donation 1:N Feedback)"
        },
        "volunteerTaskId": {
          "type": "string",
          "description": "Reference to the VolunteerTask the feedback is about. (Relationship: VolunteerTask 1:N Feedback)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given (e.g., 1-5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment providing more details."
        }
      },
      "required": [
        "id",
        "userId",
        "rating"
      ]
    },
    "Leaderboard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Leaderboard",
      "type": "object",
      "description": "Represents the leaderboard data, caching top users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leaderboard entity."
        },
        "date": {
          "type": "string",
          "description": "Date the leaderboard was generated.",
          "format": "date-time"
        },
        "topDonors": {
          "type": "array",
          "description": "Array of User IDs representing the top donors.",
          "items": {
            "type": "string"
          }
        },
        "topVolunteers": {
          "type": "array",
          "description": "Array of User IDs representing the top volunteers.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "date",
        "topDonors",
        "topVolunteers"
      ]
    },
    "SiteStats": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SiteStats",
      "type": "object",
      "description": "Represents site-wide statistics, such as daily hunger data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the site statistics entity."
        },
        "date": {
          "type": "string",
          "description": "Date the statistics were recorded.",
          "format": "date-time"
        },
        "hungerStats": {
          "type": "string",
          "description": "hunger statistics."
        }
      },
      "required": [
        "id",
        "date",
        "hungerStats"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the user can access their data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/donations/{donationId}",
        "definition": {
          "entityName": "Donation",
          "schema": {
            "$ref": "#/backend/entities/Donation"
          },
          "description": "Stores donation information. Includes 'donorId' for ownership and 'location' for listing nearby donations. The status field explicitly models the donation's state.",
          "params": [
            {
              "name": "donationId",
              "description": "The unique identifier for the donation."
            }
          ]
        }
      },
      {
        "path": "/volunteerTasks/{volunteerTaskId}",
        "definition": {
          "entityName": "VolunteerTask",
          "schema": {
            "$ref": "#/backend/entities/VolunteerTask"
          },
          "description": "Stores volunteer task information, referencing the associated donation and volunteer.",
          "params": [
            {
              "name": "volunteerTaskId",
              "description": "The unique identifier for the volunteer task."
            }
          ]
        }
      },
      {
        "path": "/feedbacks/{feedbackId}",
        "definition": {
          "entityName": "Feedback",
          "schema": {
            "$ref": "#/backend/entities/Feedback"
          },
          "description": "Stores feedback information, referencing the user, donation, and volunteer task.",
          "params": [
            {
              "name": "feedbackId",
              "description": "The unique identifier for the feedback."
            }
          ]
        }
      },
      {
        "path": "/leaderboard/{leaderboardId}",
        "definition": {
          "entityName": "Leaderboard",
          "schema": {
            "$ref": "#/backend/entities/Leaderboard"
          },
          "description": "Stores leaderboard data, caching top users. Managed by Cloud Functions.",
          "params": [
            {
              "name": "leaderboardId",
              "description": "The unique identifier for the leaderboard entry."
            }
          ]
        }
      },
      {
        "path": "/siteStats/{siteStatsId}",
        "definition": {
          "entityName": "SiteStats",
          "schema": {
            "$ref": "#/backend/entities/SiteStats"
          },
          "description": "Stores site-wide statistics. Managed by Cloud Functions.",
          "params": [
            {
              "name": "siteStatsId",
              "description": "The unique identifier for the site statistics entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization, avoiding `get()` calls in security rules. Structural Segregation ensures that each collection has a homogeneous security posture. Access Modeling standardizes authorization patterns.\n\nUsers:\nUser data is stored in `/users/{userId}`. This path-based ownership simplifies security rules, ensuring only the user can access their data.\n\nDonations:\nDonations are stored in `/donations/{donationId}`. The `donorId` field establishes ownership. To support QAPs and allow listing donations visible to a user (e.g., nearby donations), the `location` is included directly in the donation document, avoiding the need to filter based on external data. The `status` field explicitly models the donation's state.\n\nVolunteer Tasks:\nVolunteer tasks are stored in `/volunteerTasks/{volunteerTaskId}`. They include references to both the donation (`donationId`) and the volunteer (`volunteerId`).\n\nFeedbacks:\nFeedbacks are stored in `/feedbacks/{feedbackId}`. They include references to the user (`userId`), donation (`donationId`) and volunteer task (`volunteerTaskId`).\n\nLeaderboard & SiteStats:\nLeaderboard data is stored in `/leaderboard/{leaderboardId}` and site statistics in `/siteStats/{siteStatsId}`. These are global collections where documents are managed by Cloud Functions and readable by all users.\n\nThis structure supports Authorization Independence by avoiding `get()` calls in security rules. Path-based ownership (`/users/{userId}`) and direct inclusion of authorization-relevant data (like `location` in `donations`) eliminate the need for hierarchical authorization checks. QAPs are supported by Structural Segregation (separate collections for different access needs) and by including relevant data directly in documents to avoid filtering in rules."
  }
}