{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the Achayapathra application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "role": {
          "type": "string",
          "description": "User's role within the application (e.g., donor, receiver, volunteer, admin)."
        },
        "verified": {
          "type": "boolean",
          "description": "Indicates if the user's identity is verified."
        },
        "points": {
          "type": "number",
          "description": "User's reward points."
        },
        "location": {
          "type": "string",
          "description": "User's location (e.g., GeoPoint as a string)."
        },
        "identityId": {
          "type": "string",
          "description": "Unique identifier for the user's identity document (e.g., Driver's License)"
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "verified",
        "points"
      ]
    },
    "Donation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Donation",
      "type": "object",
      "description": "Represents a food donation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the donation."
        },
        "donorId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Donation). ID of the user who made the donation."
        },
        "foodName": {
          "type": "string",
          "description": "Name of the food being donated."
        },
        "foodType": {
          "type": "string",
          "description": "Type of food (e.g., cooked, perishable)."
        },
        "cookedTime": {
          "type": "string",
          "description": "Time when the food was cooked.",
          "format": "date-time"
        },
        "expiryTime": {
          "type": "string",
          "description": "Time when the food expires.",
          "format": "date-time"
        },
        "quantity": {
          "type": "string",
          "description": "Quantity of food being donated."
        },
        "description": {
          "type": "string",
          "description": "Optional description of the donation."
        },
        "location": {
          "type": "string",
          "description": "Pickup location for the donation (e.g., GeoPoint as a string)."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the food image.",
          "format": "uri"
        },
        "aiImageAnalysis": {
          "type": "string",
          "description": "Result of the AI image analysis for food safety (e.g., safe, unsafe, needs review)."
        },
        "status": {
          "type": "string",
          "description": "Status of the donation (e.g., available, picked up, delivered)."
        }
      },
      "required": [
        "id",
        "donorId",
        "foodName",
        "foodType",
        "cookedTime",
        "expiryTime",
        "quantity",
        "location",
        "imageUrl",
        "aiImageAnalysis",
        "status"
      ]
    },
    "VolunteerTask": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VolunteerTask",
      "type": "object",
      "description": "Represents a volunteer task for picking up or delivering donations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the volunteer task."
        },
        "donationId": {
          "type": "string",
          "description": "Reference to Donation. (Relationship: Donation 1:N VolunteerTask). ID of the donation associated with the task."
        },
        "volunteerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N VolunteerTask). ID of the volunteer assigned to the task."
        },
        "type": {
          "type": "string",
          "description": "Type of task (e.g., pickup, delivery)."
        },
        "status": {
          "type": "string",
          "description": "Status of the task (e.g., assigned, completed, cancelled)."
        },
        "pickupLocation": {
          "type": "string",
          "description": "Pickup location for the task (e.g., GeoPoint as a string)."
        },
        "deliveryLocation": {
          "type": "string",
          "description": "Delivery location for the task (e.g., GeoPoint as a string)."
        }
      },
      "required": [
        "id",
        "donationId",
        "volunteerId",
        "type",
        "status"
      ]
    },
    "Feedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Feedback",
      "type": "object",
      "description": "Represents feedback given for a donation or volunteer task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the feedback."
        },
        "donationId": {
          "type": "string",
          "description": "Reference to Donation. (Relationship: Donation 1:N Feedback). ID of the donation the feedback is about (Optional)."
        },
        "volunteerTaskId": {
          "type": "string",
          "description": "Reference to VolunteerTask. (Relationship: VolunteerTask 1:N Feedback). ID of the volunteer task the feedback is about (Optional)."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Feedback). ID of the user giving the feedback."
        },
        "rating": {
          "type": "number",
          "description": "Rating given (e.g., 1 to 5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Optional comment accompanying the rating."
        }
      },
      "required": [
        "id",
        "userId",
        "rating"
      ]
    },
    "LeaderboardEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaderboardEntry",
      "type": "object",
      "description": "Represents an entry in the leaderboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leaderboard entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LeaderboardEntry). ID of the user in the leaderboard."
        },
        "points": {
          "type": "number",
          "description": "User's points on the leaderboard."
        },
        "rank": {
          "type": "number",
          "description": "User's rank on the leaderboard."
        },
        "date": {
          "type": "string",
          "description": "Date of the leaderboard entry.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "points",
        "rank",
        "date"
      ]
    },
    "SiteStats": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SiteStats",
      "type": "object",
      "description": "Represents site statistics.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the site statistics."
        },
        "date": {
          "type": "string",
          "description": "Date for which the statistics are recorded.",
          "format": "date-time"
        },
        "hungerData": {
          "type": "string",
          "description": "Data related to hunger statistics (e.g., number of donations, people fed)."
        }
      },
      "required": [
        "id",
        "date",
        "hungerData"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  'userId' is the Firebase Auth UID. Only the user can modify their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/donations/{donationId}",
        "definition": {
          "entityName": "Donation",
          "schema": {
            "$ref": "#/backend/entities/Donation"
          },
          "description": "Stores donations associated with a specific user. Only the user can create/modify donations in their subcollection.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user (donor)."
            },
            {
              "name": "donationId",
              "description": "Unique ID of the donation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/volunteerTasks/{volunteerTaskId}",
        "definition": {
          "entityName": "VolunteerTask",
          "schema": {
            "$ref": "#/backend/entities/VolunteerTask"
          },
          "description": "Stores volunteer tasks associated with a specific user. Only the user can create/modify volunteerTasks in their subcollection.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user (volunteer)."
            },
            {
              "name": "volunteerTaskId",
              "description": "Unique ID of the volunteer task."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/feedback/{feedbackId}",
        "definition": {
          "entityName": "Feedback",
          "schema": {
            "$ref": "#/backend/entities/Feedback"
          },
          "description": "Stores feedback associated with a specific user. Only the user can create/modify feedback in their subcollection.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user giving the feedback."
            },
            {
              "name": "feedbackId",
              "description": "Unique ID of the feedback."
            }
          ]
        }
      },
      {
        "path": "/leaderboard/{leaderboardEntryId}",
        "definition": {
          "entityName": "LeaderboardEntry",
          "schema": {
            "$ref": "#/backend/entities/LeaderboardEntry"
          },
          "description": "Stores leaderboard entries. Only accessible by the admin.",
          "params": [
            {
              "name": "leaderboardEntryId",
              "description": "Unique ID of the leaderboard entry."
            }
          ]
        }
      },
      {
        "path": "/siteStats/{siteStatsId}",
        "definition": {
          "entityName": "SiteStats",
          "schema": {
            "$ref": "#/backend/entities/SiteStats"
          },
          "description": "Stores site statistics. Only accessible by the admin.",
          "params": [
            {
              "name": "siteStatsId",
              "description": "Unique ID of the site statistics document."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection grant admin privileges.  Authorization rules check for the existence of a document with the user's UID in this collection.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support Achayapathra's food donation web application, focusing on secure and efficient data access. Authorization Independence is achieved by denormalizing relevant user roles where needed. Path-based ownership is used for user-specific data (donations, volunteer tasks, and feedback).  The structure facilitates secure `list` operations (QAPs) through structural segregation and role-based access control, enforced in the security rules.\n\nSpecifically:\n\n*   `/users/{userId}`: Stores user profiles. Access control is based on the `userId`.\n*   `/users/{userId}/donations/{donationId}`:  Donations are stored as subcollections to their respective owners. Security rules can easily validate that only the user can create or modify donations in their path.\n*   `/users/{userId}/volunteerTasks/{volunteerTaskId}`:  Volunteer Tasks are stored as subcollections to their respective owners. Security rules can easily validate that only the user can create or modify volunteerTasks in their path.\n*   `/users/{userId}/feedback/{feedbackId}`: Feedbacks are stored as subcollections to their respective owners. Security rules can easily validate that only the user can create or modify feedbacks in their path.\n*   `/leaderboard/{leaderboardEntryId}`: Stores leaderboard entries.  Admin-writeable only.\n*   `/siteStats/{siteStatsId}`: Stores site statistics. Admin-writeable only.\n*   `/roles_admin/{userId}`: Documents in this collection indicate admin roles.  Existence is checked in rules for admin-only operations.\n\nThis structure avoids complex `get()` calls in security rules, promoting atomic operations and easier debugging. Segregation ensures that each collection has a clear and consistent security posture."
  }
}